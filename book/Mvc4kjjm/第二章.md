* #  第二章 URL 路由

### 一、ASP.NET 路由系统 

###### 1.Route和RouteTable

        Web 应用具有一个全局的路由表,通过 System. Web.Routing.RouteTable的静态只读属性 Routes 表示
    属性返回一个类型为System. Web.Routing.RouteCollection集合,通过调用 RouteCollection MapPageRoute方法将
    某个物理文件路径映射到一个URL模板上
    
```.cs
protected void Application_Start(object sender, EventArgs e)
{
  //注册默认路由键值对
  var defaults = new RouteValueDictionary{{"name" ,"sa"}， {"id" , "1" } } ;
  //将url与物理路径绑定添加到路由表
  RouteTable.Routes.MapPageRoute("" , "employees/{name}/{id}" , "-/Default.aspx" , true , defaults); 
}
```

###### 2.RouteBase RouteData VirtualPathData
    
          路由对象实现了具有如下定义的抽象类System. Web. Routing.RouteBase如Route,。抽象方法 GetRouteData
     GetVirtualPath方法都会试着根据 URL 模板的模式与代表请求地址的 URL 进行匹配
     
* ###### `RouteBase`     
 |GetRouteData|GetVirtualPath|
 |-|-|
 |得到一个用于封装路由信息的 RouteData 对象|GetVirtualPath会生成一个 URL封装为VirtualPathData|
 
* ###### `RouteData`  

          在对RouteCollection的类中默认会在MapPageRoute的时候实例化路由对象Route并注册一个PageRouteHandler
      这个handler是一个实现IRouteHandler的实例,也是webform中很重要的一个点,包括mvc的实现也是围绕IRouteHandler.
      
  ```.cs
  //将Route对象加到路由表中
  public Route MapPageRoute(string routeName, string routeUrl, string physicalFile,
                            bool checkPhysicalUrlAccess, RouteValueDictionary defaults, 
                            RouteValueDictionary constraints, RouteValueDictionary dataTokens)
		{
			if (routeUrl == null)
			{
				throw new ArgumentNullException("routeUrl");
			}
			Route route = new Route(routeUrl, defaults, constraints, dataTokens, 
      new PageRouteHandler(physicalFile, checkPhysicalUrlAccess));
			this.Add(routeName, route);
			return route;
		}
    
  ```
 |Values|DataTokens|GetRequiredString|RouteHandler|
 |-|-|-|-|
 |RouteValueDictionary类型用于保存路由变量的字典从请求的URL的解析得到|直接附加到路由对象上的自定义变量|用于获取指定key的变量值|提供最终用于处理请求的Handler对象|
 
 
   
         
 
